!function($,t){function i(t){var i=t.originalEvent.changedTouches[0];return $.extend(t,{type:o[t.type],which:1,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY,isTouchEvent:!0})}var o={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"},e="ongesturestart"in document.createElement("div"),s=$.ui.mouse.prototype,n=$.ui.mouse.prototype._mouseInit;s._mouseInit=function(){var t=this;t._touchActive=!1,this.element.bind("touchstart."+this.widgetName,function(o){return e&&o.originalEvent.touches.length>1?void 0:(t._touchActive=!0,t._mouseDown(i(o)))});var t=this;this._mouseMoveDelegate=function(o){return e&&o.originalEvent.touches&&o.originalEvent.touches.length>1?void 0:t._touchActive?t._mouseMove(i(o)):void 0},this._mouseUpDelegate=function(o){return t._touchActive?(t._touchActive=!1,t._mouseUp(i(o))):void 0},$(document).bind("touchmove."+this.widgetName,this._mouseMoveDelegate).bind("touchend."+this.widgetName,this._mouseUpDelegate),n.apply(this)};var h=function(t,i){return function(o){return 0===arguments.length?i.apply(this):void t.apply(this,arguments)}},r={0:{marginLeft:0,marginTop:0,filter:'progid:DXImageTransform.Microsoft.Matrix(M11=1, M12=0, M21=0, M22=1, SizingMethod="auto expand")'},90:{marginLeft:-1,marginTop:1,filter:'progid:DXImageTransform.Microsoft.Matrix(M11=0, M12=-1, M21=1, M22=0, SizingMethod="auto expand")'},180:{marginLeft:0,marginTop:0,filter:'progid:DXImageTransform.Microsoft.Matrix(M11=-1, M12=0, M21=0, M22=-1, SizingMethod="auto expand")'},270:{marginLeft:-1,marginTop:1,filter:'progid:DXImageTransform.Microsoft.Matrix(M11=0, M12=1, M21=-1, M22=0, SizingMethod="auto expand")'}},a=function(){var i=document.createElement("modernizr"),o=i.style,e="Webkit Moz O ms",s=e.toLowerCase().split(" "),n=("transform "+s.join("Transform ")+"Transform").split(" ");for(var h in n){var r=n[h];if(!$.contains(r,"-")&&o[r]!==t)return!1}return!0}();$.widget("ui.iviewer",$.ui.mouse,{widgetEventPrefix:"iviewer",options:{zoom:"fit",zoom_base:100,zoom_max:800,zoom_min:25,zoom_delta:1.4,zoom_animation:!0,ui_disabled:!1,mousewheel:!0,update_on_resize:!0,onZoom:jQuery.noop,onAfterZoom:jQuery.noop,onStartDrag:jQuery.noop,onDrag:jQuery.noop,onStopDrag:jQuery.noop,onMouseMove:jQuery.noop,onClick:jQuery.noop,onStartLoad:null,onFinishLoad:null,onErrorLoad:null},_create:function(){var t=this;if(this.dx=0,this.dy=0,this.img_object={},this.zoom_object={},this._angle=0,this.current_zoom=this.options.zoom,null!==this.options.src){if(this.container=this.element,this._updateContainerInfo(),this.container.css("overflow","hidden"),1==this.options.update_on_resize&&$(window).resize(function(){t.update()}),this.img_object=new $.ui.iviewer.ImageObject(this.options.zoom_animation),this.options.mousewheel&&(this.container.bind("mousewheel.iviewer",function(i,o){var e=o>0?1:-1,s=t.container.offset(),n={x:(i.pageX||i.originalEvent.pageX)-s.left,y:(i.pageY||i.originalEvent.pageX)-s.top};return t.zoom_by(e,n),!1}),e)){var i=+new Date,o,s;this.img_object.object().bind("touchstart",function(i){o=t.current_zoom;var e=i.originalEvent.touches,n;2==e.length?(n=t.container.offset(),s={x:(e[0].pageX+e[1].pageX)/2-n.left,y:(e[0].pageY+e[1].pageY)/2-n.top}):s=null}).bind("gesturechange",function(e){var n=+new Date;if(!(50>n-i)){i=n;var h=o*e.originalEvent.scale;t.set_zoom(h,s),e.preventDefault()}}).bind("gestureend",function(t){s=null})}this.img_object.object().click(function(i){return t._click(i)}).prependTo(this.container),this.container.bind("mousemove",function(i){t._handleMouseMove(i)}),this.loadImage(this.options.src),this.options.ui_disabled||this.createui(),this._mouseInit()}},destroy:function(){$.Widget.prototype.destroy.call(this),this._mouseDestroy(),this.img_object.object().remove(),this.container.off(".iviewer"),this.container.css("overflow","")},_updateContainerInfo:function(){this.options.height=this.container.height(),this.options.width=this.container.width()},update:function(){this._updateContainerInfo(),this.setCoords(this.img_object.x(),this.img_object.y())},loadImage:function(t){this.current_zoom=this.options.zoom;var i=this;this._trigger("onStartLoad",0,t),this.container.addClass("iviewer_loading"),this.img_object.load(t,function(){i._imageLoaded(t)},function(){i._trigger("onErrorLoad",0,t)})},_imageLoaded:function(t){this.container.removeClass("iviewer_loading"),this.container.addClass("iviewer_cursor"),"fit"==this.options.zoom?this.fit(!0):this.set_zoom(this.options.zoom,!0),this._trigger("onFinishLoad",0,t)},fit:function(t){var i=this.img_object.orig_width()/this.img_object.orig_height(),o=this.options.width/this.options.height,e=i>o,s=0;s=e?this.options.width/this.img_object.orig_width()*100:this.options.height/this.img_object.orig_height()*100,this.set_zoom(s,t)},center:function(){this.setCoords(-Math.round((this.img_object.display_width()-this.options.width)/2),-Math.round((this.img_object.display_height()-this.options.height)/2))},moveTo:function(t,i){var o=t-Math.round(this.options.width/2),e=i-Math.round(this.options.height/2),s=this.img_object.x()-o,n=this.img_object.y()-e;this.setCoords(s,n)},getContainerOffset:function(){return jQuery.extend({},this.container.offset())},setCoords:function(t,i){if(this.img_object.loaded()){var o=this._correctCoords(t,i);this.img_object.x(o.x),this.img_object.y(o.y)}},_correctCoords:function(t,i){return t=parseInt(t,10),i=parseInt(i,10),i>0&&(i=0),t>0&&(t=0),i+this.img_object.display_height()<this.options.height&&(i=this.options.height-this.img_object.display_height()),t+this.img_object.display_width()<this.options.width&&(t=this.options.width-this.img_object.display_width()),this.img_object.display_width()<=this.options.width&&(t=-(this.img_object.display_width()-this.options.width)/2),this.img_object.display_height()<=this.options.height&&(i=-(this.img_object.display_height()-this.options.height)/2),{x:t,y:i}},containerToImage:function(t,i){var o={x:t-this.img_object.x(),y:i-this.img_object.y()};return o=this.img_object.toOriginalCoords(o),{x:c.descaleValue(o.x,this.current_zoom),y:c.descaleValue(o.y,this.current_zoom)}},imageToContainer:function(t,i){var o={x:c.scaleValue(t,this.current_zoom),y:c.scaleValue(i,this.current_zoom)};return this.img_object.toRealCoords(o)},_getMouseCoords:function(t){var i=this.container.offset();return coords=this.containerToImage(t.pageX-i.left,t.pageY-i.top),coords},set_zoom:function(t,i,o){if(0!=this._trigger("onZoom",0,t)&&this.img_object.loaded()){if(o=o||{x:Math.round(this.options.width/2),y:Math.round(this.options.height/2)},t<this.options.zoom_min?t=this.options.zoom_min:t>this.options.zoom_max&&(t=this.options.zoom_max),"fit"==this.current_zoom){var e=o.x+Math.round(this.img_object.orig_width()/2),s=o.y+Math.round(this.img_object.orig_height()/2);this.current_zoom=100}else var e=-this.img_object.x()+o.x,s=-this.img_object.y()+o.y;var n=c.scaleValue(this.img_object.orig_width(),t),h=c.scaleValue(this.img_object.orig_height(),t),r=c.scaleValue(c.descaleValue(e,this.current_zoom),t),a=c.scaleValue(c.descaleValue(s,this.current_zoom),t);r=o.x-r,a=o.y-a,n=Math.floor(n),h=Math.floor(h),r=Math.floor(r),a=Math.floor(a),this.img_object.display_width(n),this.img_object.display_height(h);var _=this._correctCoords(r,a),u=this;this.img_object.setImageProps(n,h,_.x,_.y,i,function(){u._trigger("onAfterZoom",0,t)}),this.current_zoom=t,this.update_status()}},zoom_by:function(i,o){var e=this.find_closest_zoom_rate(this.current_zoom),s=e+i,n=this.options.zoom_base*Math.pow(this.options.zoom_delta,s);i>0&&n<this.current_zoom&&(n*=this.options.zoom_delta),0>i&&n>this.current_zoom&&(n/=this.options.zoom_delta),this.set_zoom(n,t,o)},angle:function(t,i){return 0===arguments.length?this.img_object.angle():void(-270>t||t>270||t%90!==0||(i||(t+=this.img_object.angle()),0>t&&(t+=360),t>=360&&(t-=360),t!==this.img_object.angle()&&(this.img_object.angle(t),this.center(),this._trigger("angle",0,{angle:this.img_object.angle()}))))},find_closest_zoom_rate:function(t){function i(t,i){return t/i}function o(t,i){return t*i}if(t==this.options.zoom_base)return 0;for(var e=t>this.options.zoom_base?o:i,s=t>this.options.zoom_base?1:-1,n=this.options.zoom_delta,h=1;Math.abs(e(this.options.zoom_base,Math.pow(n,h))-t)>Math.abs(e(this.options.zoom_base,Math.pow(n,h+1))-t);)h++;return s*h},update_status:function(){if(!this.options.ui_disabled){var t=Math.round(100*this.img_object.display_height()/this.img_object.orig_height());t&&this.zoom_object.html(t+"%")}},info:function(t,i){if(t)switch(t){case"orig_width":case"orig_height":return i?this.img_object.angle()%180===0?this.img_object[t]():"orig_width"===t?this.img_object.orig_height():this.img_object.orig_width():this.img_object[t]();case"display_width":case"display_height":case"angle":return this.img_object[t]();case"zoom":return this.current_zoom;case"src":return this.img_object.object().attr("src");case"coords":return{x:this.img_object.x(),y:this.img_object.y()}}},_mouseStart:function(t){return $.ui.mouse.prototype._mouseStart.call(this,t),this._trigger("onStartDrag",0,this._getMouseCoords(t))===!1?!1:(this.container.addClass("iviewer_drag_cursor"),this._dragInitialized=!(t.originalEvent.changedTouches&&1==t.originalEvent.changedTouches.length),this.dx=t.pageX-this.img_object.x(),this.dy=t.pageY-this.img_object.y(),!0)},_mouseCapture:function(t){return!0},_handleMouseMove:function(t){this._trigger("onMouseMove",t,this._getMouseCoords(t))},_mouseDrag:function(t){$.ui.mouse.prototype._mouseDrag.call(this,t),this._dragInitialized||(this.dx=t.pageX-this.img_object.x(),this.dy=t.pageY-this.img_object.y(),this._dragInitialized=!0);var i=t.pageY-this.dy,o=t.pageX-this.dx;return this.setCoords(o,i),this._trigger("onDrag",t,this._getMouseCoords(t)),!1},_mouseStop:function(t){$.ui.mouse.prototype._mouseStop.call(this,t),this.container.removeClass("iviewer_drag_cursor"),this._trigger("onStopDrag",0,this._getMouseCoords(t))},_click:function(t){this._trigger("onClick",0,this._getMouseCoords(t))},createui:function(){var t=this;$("<div>",{"class":"iviewer_zoom_in iviewer_common iviewer_button"}).bind("mousedown touchstart",function(){return t.zoom_by(1),!1}).appendTo(this.container),$("<div>",{"class":"iviewer_zoom_out iviewer_common iviewer_button"}).bind("mousedown touchstart",function(){return t.zoom_by(-1),!1}).appendTo(this.container),$("<div>",{"class":"iviewer_zoom_zero iviewer_common iviewer_button"}).bind("mousedown touchstart",function(){return t.set_zoom(100),!1}).appendTo(this.container),$("<div>",{"class":"iviewer_zoom_fit iviewer_common iviewer_button"}).bind("mousedown touchstart",function(){return t.fit(this),!1}).appendTo(this.container),this.zoom_object=$("<div>").addClass("iviewer_zoom_status iviewer_common").appendTo(this.container),$("<div>",{"class":"iviewer_rotate_left iviewer_common iviewer_button"}).bind("mousedown touchstart",function(){return t.angle(-90),!1}).appendTo(this.container),$("<div>",{"class":"iviewer_rotate_right iviewer_common iviewer_button"}).bind("mousedown touchstart",function(){return t.angle(90),!1}).appendTo(this.container),this.update_status()}}),$.ui.iviewer.ImageObject=function(t){this._img=$("<img>").css({position:"absolute",top:"0px",left:"0px"}),this._loaded=!1,this._swapDimensions=!1,this._do_anim=t||!1,this.x(0,!0),this.y(0,!0),this.angle(0)},function(){this._reset=function(t,i){this._angle=0,this._swapDimensions=!1,this.x(0),this.y(0),this.orig_width(t),this.orig_height(i),this.display_width(t),this.display_height(i)},this.loaded=function(){return this._loaded},this.load=function(t,i,o){var e=this;i=i||jQuery.noop,this._loaded=!1;var s=new Image;s.onload=function(){e._loaded=!0,e._reset(this.width,this.height),e._img.removeAttr("width").removeAttr("height").removeAttr("style").css({position:"absolute",top:"0px",left:"0px",maxWidth:"none"}),e._img[0].src=t,i()},s.onerror=o,setTimeout(function(){s.src=t},0),this.angle(0)},this._dimension=function(t,i){var o="_"+t+"_"+i,e="_"+t+"_"+("height"===i?"width":"height");return h(function(t){this[this._swapDimensions?o:e]=t},function(){return this[this._swapDimensions?o:e]})},this.display_width=this._dimension("display","width"),this.display_height=this._dimension("display","height"),this.display_diff=function(){return Math.floor(this.display_width()-this.display_height())},this.orig_width=this._dimension("orig","width"),this.orig_height=this._dimension("orig","height"),this.x=h(function(t,i){this._x=t,i||(this._finishAnimation(),this._img.css("left",this._x+(this._swapDimensions?this.display_diff()/2:0)+"px"))},function(){return this._x}),this.y=h(function(t,i){this._y=t,i||(this._finishAnimation(),this._img.css("top",this._y-(this._swapDimensions?this.display_diff()/2:0)+"px"))},function(){return this._y}),this.angle=h(function(t){var i=this._swapDimensions;if(this._angle=t,this._swapDimensions=t%180!==0,i!==this._swapDimensions){var o=this._swapDimensions?-1:1;this.x(this.x()-o*this.display_diff()/2,!0),this.y(this.y()+o*this.display_diff()/2,!0)}var e="rotate("+t+"deg)",s=this._img;jQuery.each(["","-webkit-","-moz-","-o-","-ms-"],function(t,i){s.css(i+"transform",e)}),a&&(jQuery.each(["-ms-",""],function(i,o){s.css(o+"filter",r[t].filter)}),s.css({marginLeft:r[t].marginLeft*this.display_diff()/2,marginTop:r[t].marginTop*this.display_diff()/2}))},function(){return this._angle}),this.toOriginalCoords=function(t){switch(this.angle()){case 0:return{x:t.x,y:t.y};case 90:return{x:t.y,y:this.display_width()-t.x};case 180:return{x:this.display_width()-t.x,y:this.display_height()-t.y};case 270:return{x:this.display_height()-t.y,y:t.x}}},this.toRealCoords=function(t){switch(this.angle()){case 0:return{x:this.x()+t.x,y:this.y()+t.y};case 90:return{x:this.x()+this.display_width()-t.y,y:this.y()+t.x};case 180:return{x:this.x()+this.display_width()-t.x,y:this.y()+this.display_height()-t.y};case 270:return{x:this.x()+t.y,y:this.y()+this.display_height()-t.x}}},this.object=h(jQuery.noop,function(){return this._img}),this.setImageProps=function(t,i,o,e,s,n){n=n||jQuery.noop,this.display_width(t),this.display_height(i),this.x(o,!0),this.y(e,!0);var h=this._swapDimensions?i:t,c=this._swapDimensions?t:i,_={width:h,height:c,top:e-(this._swapDimensions?this.display_diff()/2:0)+"px",left:o+(this._swapDimensions?this.display_diff()/2:0)+"px"};a&&jQuery.extend(_,{marginLeft:r[this.angle()].marginLeft*this.display_diff()/2,marginTop:r[this.angle()].marginTop*this.display_diff()/2});var u=this._swapDimensions,d=this._img;if(a&&u){var g=this._img.width(),m=this._img.height(),p=_.height-g;iedw=_.width-m,delete _.width,delete _.height}this._do_anim&&!s?this._img.stop(!0).animate(_,{duration:200,complete:n,step:function(t,i){if(a&&u&&"top"===i.prop){var o=(t-i.start)/(i.end-i.start);d.height(g+p*o),d.width(m+iedw*o),d.css("top",t)}}}):(this._img.css(_),setTimeout(n,0))},this._finishAnimation=function(){this._img.stop(!0,!0)}}.apply($.ui.iviewer.ImageObject.prototype);var c={scaleValue:function(t,i){return t*i/100},descaleValue:function(t,i){return 100*t/i}}}(jQuery,void 0);